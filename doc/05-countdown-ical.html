<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>教學｜05 事件倒數 + iCal（Blob 下載）</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
<style>
  :root{--bg:#fafafa;--card:#fff;--fg:#111827;--muted:#6b7280;--line:#e5e7eb;--accent:#2563eb}
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;line-height:1.65}
  header{position:sticky;top:0;background:#ffffffcc;backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:10}
  .container{max-width:1000px;margin:auto;padding:14px 16px}
  h1{margin:0;font-size:clamp(20px,3.2vw,30px)}
  h2{margin:18px 0 8px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:16px;margin:14px 0}
  .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#1e3a8a;font-size:12px}
  .muted{color:var(--muted)}
  .codeblock{position:relative;border:1px solid var(--line);border-radius:12px;overflow:hidden}
  .codehead{display:flex;align-items:center;justify-content:space-between;background:#f3f4f6;border-bottom:1px solid var(--line);padding:8px 10px}
  .codehead .title{font-weight:700}
  .btn{padding:6px 10px;border:0;border-radius:8px;background:var(--accent);color:#fff;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  pre{margin:0;max-height:70vh;overflow:auto}
  .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .2s ease}
  .toast.show{opacity:1}
  ul.list,ol.list{padding-left:1.25em;margin:6px 0}
</style>
</head>
<body>
<header>
  <div class="container">
    <h1>05｜事件倒數 + iCal（Blob 下載） <span class="badge">HTML / CSS / JS</span></h1>
  </div>
</header>

<main class="container">
  <section class="card">
    <h2>功能描述</h2>
    <p>輸入事件名稱與日期時間，啟動倒數計時；同時可一鍵匯出 <code>.ics</code> 行事曆檔（含 <b>Asia/Taipei</b> 時區），方便匯入各家日曆。範例包含時間格式處理、<code>Blob</code> 建檔與 <code>a.download</code> 觸發下載。</p>

    <h2>使用方法</h2>
    <ol class="list">
      <li>輸入事件名稱與時間，按「開始倒數」。</li>
      <li>下方顯示「剩餘 天:時:分:秒」。到時自動顯示提示文字。</li>
      <li>按「下載 iCal」可產生 <code>.ics</code> 檔，匯入行事曆。</li>
    </ol>

    <h2>應用技術</h2>
    <ul class="list">
      <li>時間差計算與 <code>setInterval</code> 倒數</li>
      <li>ICS 文字模板、<code>Blob</code> 與 <code>URL.createObjectURL</code></li>
      <li>台北時區（Asia/Taipei）<code>VTIMEZONE</code> 區段寫入</li>
    </ul>
  </section>

  <section class="card">
    <h2>完整可執行（單檔內嵌版）</h2>
    <div class="muted">把下方程式碼另存為 <code>countdown-single.html</code>，直接開啟即可。</div>
    <div class="codeblock" style="margin-top:10px">
      <div class="codehead">
        <div class="title">countdown-single.html</div>
        <div class="btns">
          <button class="btn downloadbtn" data-download="code-single" data-filename="countdown-single.html">下載</button>
          <button class="btn copybtn" data-copy="code-single">複製</button>
        </div>
      </div>
      <pre><code id="code-single" class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh-Hant&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
  &lt;title&gt;事件倒數 + iCal（單檔版）&lt;/title&gt;
  &lt;style&gt;
    body{margin:0;min-height:100vh;display:grid;place-items:center;background:#0f172a;color:#e5e7eb;font-family:system-ui,&quot;Noto Sans TC&quot;,sans-serif}
    .card{background:#0b1220;border:1px solid #1f2937;border-radius:18px;padding:24px 28px;box-shadow:0 10px 30px #0006;width:min(560px,90vw)}
    input,button{padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#0b1220;color:#e5e7eb}
    button{background:#22d3ee;color:#00343d;border:0;font-weight:800;cursor:pointer}
    .time{font-size:28px;font-weight:800;margin-top:8px}
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;card&quot; id=&quot;ical&quot;&gt;
  &lt;h2&gt;事件倒數&lt;/h2&gt;
  &lt;div style=&quot;display:grid;gap:8px;grid-template-columns:1fr 1fr&quot;&gt;
    &lt;input id=&quot;title&quot; placeholder=&quot;事件名稱：面試 / Demo Day&quot;&gt;
    &lt;input id=&quot;time&quot; type=&quot;datetime-local&quot;&gt;
  &lt;/div&gt;
  &lt;button id=&quot;start&quot; style=&quot;margin-top:8px&quot;&gt;開始倒數&lt;/button&gt;
  &lt;div class=&quot;time&quot; id=&quot;t&quot;&gt;請設定時間&lt;/div&gt;
  &lt;button id=&quot;dl&quot; style=&quot;margin-top:8px&quot;&gt;下載 iCal&lt;/button&gt;
  &lt;div class=&quot;small&quot; style=&quot;color:#9ca3af;margin-top:6px&quot;&gt;時間以 &lt;b&gt;Asia/Taipei&lt;/b&gt; 寫入；預設結束時間 +25 分鐘。&lt;/div&gt;
&lt;/div&gt;
&lt;script&gt;
(()=>{const r=document.querySelector('#ical'),$=q=&gt;r.querySelector(q);let target=null,timer=null;const T=$('#t');const pad=n=&gt;String(n).padStart(2,'0');const fmtICS=d=&gt;d.getFullYear()+pad(d.getMonth()+1)+pad(d.getDate())+'T'+pad(d.getHours())+pad(d.getMinutes())+pad(d.getSeconds());const tick=()=&gt;{const d=target-new Date;if(d&lt;=0){T.textContent='到時囉！';clearInterval(timer);timer=null;return}const s=((d/1e3)|0)%60,m=((d/6e4)|0)%60,h=((d/36e5)|0)%24,day=(d/864e5)|0;T.textContent=`${day} 天 ${pad(h)}:${pad(m)}:${pad(s)}`};$('#start').onclick=()=&gt;{const v=$('#time').value;if(!v)return alert('請選時間');target=new Date(v);clearInterval(timer);timer=setInterval(tick,1e3);tick()};$('#dl').onclick=()=&gt;{const title=$('#title').value||'我的事件',v=$('#time').value;if(!v)return alert('請先選時間');const start=new Date(v);const end=new Date(start.getTime()+25*60*1000);const dtstart=fmtICS(start),dtend=fmtICS(end),stamp=fmtICS(new Date());const ics='BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Demo//iCal//TW\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n'+'BEGIN:VTIMEZONE\nTZID:Asia/Taipei\nX-LIC-LOCATION:Asia/Taipei\nBEGIN:STANDARD\nTZOFFSETFROM:+0800\nTZOFFSETTO:+0800\nTZNAME:CST\nDTSTART:19700101T000000\nEND:STANDARD\nEND:VTIMEZONE\n'+'BEGIN:VEVENT\nUID:'+Date.now()+'@demo\nDTSTAMP:'+stamp+'\nDTSTART;TZID=Asia/Taipei:'+dtstart+'\nDTEND;TZID=Asia/Taipei:'+dtend+'\nSUMMARY:'+title+'\nEND:VEVENT\nEND:VCALENDAR';const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([ics],{type:'text/calendar'}));a.download='event.ics';a.click();URL.revokeObjectURL(a.href)}})();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
    </div>
  </section>

  <section class="card">
    <h2>分離版：HTML（countdown-standalone.html）</h2>
    <div class="muted">請與 <code>countdown.css</code>、<code>countdown.js</code> 放在同一資料夾。</div>
    <div class="codeblock" style="margin-top:10px">
      <div class="codehead">
        <div class="title">countdown-standalone.html</div>
        <div class="btns">
          <button class="btn downloadbtn" data-download="code-html" data-filename="countdown-standalone.html">下載</button>
          <button class="btn copybtn" data-copy="code-html">複製</button>
        </div>
      </div>
      <pre><code id="code-html" class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh-Hant&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot; /&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot; /&gt;
  &lt;title&gt;事件倒數 + iCal（分離版）&lt;/title&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;./countdown.css&quot; /&gt;
  &lt;script src=&quot;./countdown.js&quot; defer&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class=&quot;card&quot; id=&quot;ical&quot;&gt;
    &lt;h2&gt;事件倒數&lt;/h2&gt;
    &lt;div class=&quot;row&quot;&gt;
      &lt;input id=&quot;title&quot; placeholder=&quot;事件名稱：面試 / Demo Day&quot;&gt;
      &lt;input id=&quot;time&quot; type=&quot;datetime-local&quot;&gt;
    &lt;/div&gt;
    &lt;button class=&quot;accent&quot; id=&quot;start&quot;&gt;開始倒數&lt;/button&gt;
    &lt;div class=&quot;time&quot; id=&quot;t&quot;&gt;請設定時間&lt;/div&gt;
    &lt;button id=&quot;dl&quot;&gt;下載 iCal&lt;/button&gt;
    &lt;div class=&quot;small&quot;&gt;時間以 &lt;b&gt;Asia/Taipei&lt;/b&gt; 寫入；預設結束時間 +25 分鐘。&lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
    </div>
  </section>

  <section class="card">
    <h2>分離版：CSS（countdown.css）</h2>
    <div class="codeblock" style="margin-top:10px">
      <div class="codehead">
        <div class="title">countdown.css</div>
        <div class="btns">
          <button class="btn downloadbtn" data-download="code-css" data-filename="countdown.css">下載</button>
          <button class="btn copybtn" data-copy="code-css">複製</button>
        </div>
      </div>
      <pre><code id="code-css" class="language-css">body{margin:0;min-height:100vh;display:grid;place-items:center;background:#0f172a;color:#e5e7eb;font-family:system-ui,"Noto Sans TC",sans-serif}
.card{background:#0b1220;border:1px solid #1f2937;border-radius:18px;padding:24px 28px;box-shadow:0 10px 30px #0006;width:min(560px,90vw)}
.row{display:grid;gap:8px;grid-template-columns:1fr 1fr}
input,button{padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#0b1220;color:#e5e7eb}
button{background:#22d3ee;color:#00343d;border:0;font-weight:800;cursor:pointer}
button.accent{background:#22d3ee;color:#00343d}
.time{font-size:28px;font-weight:800;margin-top:8px}
.small{color:#9ca3af;margin-top:6px}
</code></pre>
    </div>
  </section>

  <section class="card">
    <h2>分離版：JavaScript（countdown.js）</h2>
    <div class="codeblock" style="margin-top:10px">
      <div class="codehead">
        <div class="title">countdown.js</div>
        <div class="btns">
          <button class="btn downloadbtn" data-download="code-js" data-filename="countdown.js">下載</button>
          <button class="btn copybtn" data-copy="code-js">複製</button>
        </div>
      </div>
      <pre><code id="code-js" class="language-js">(() =&gt; {
  const root=document.querySelector('#ical');
  if(!root){ console.error('[iCal] 找不到 #ical'); return; }
  const $=(q)=&gt;root.querySelector(q);
  let target=null, timer=null;
  const T=$('#t');
  const pad=(n)=&gt;String(n).padStart(2,'0');
  const fmtICS=(d)=&gt; d.getFullYear()+pad(d.getMonth()+1)+pad(d.getDate())+'T'+pad(d.getHours())+pad(d.getMinutes())+pad(d.getSeconds());

  function tick(){
    const d = target - new Date();
    if(d &lt;= 0){ T.textContent='到時囉！'; clearInterval(timer); timer=null; return; }
    const sec=((d/1e3)|0)%60, min=((d/6e4)|0)%60, hr=((d/36e5)|0)%24, day=(d/864e5)|0;
    T.textContent = `${day} 天 ${pad(hr)}:${pad(min)}:${pad(sec)}`;
  }

  $('#start').onclick = () =&gt; {
    const v = $('#time').value;
    if(!v) return alert('請選時間');
    target = new Date(v);
    clearInterval(timer);
    timer = setInterval(tick, 1000);
    tick();
  };

  $('#dl').onclick = () =&gt; {
    const title=$('#title').value || '我的事件';
    const v=$('#time').value; if(!v) return alert('請先選時間');
    const start=new Date(v);
    const end=new Date(start.getTime()+25*60*1000);
    const dtstart=fmtICS(start), dtend=fmtICS(end), stamp=fmtICS(new Date());
    const ics=
'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Demo//iCal//TW\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n'+
'BEGIN:VTIMEZONE\nTZID:Asia/Taipei\nX-LIC-LOCATION:Asia/Taipei\nBEGIN:STANDARD\nTZOFFSETFROM:+0800\nTZOFFSETTO:+0800\nTZNAME:CST\nDTSTART:19700101T000000\nEND:STANDARD\nEND:VTIMEZONE\n'+
'BEGIN:VEVENT\nUID:'+Date.now()+'@demo\nDTSTAMP:'+stamp+'\nDTSTART;TZID=Asia/Taipei:'+dtstart+'\nDTEND;TZID=Asia/Taipei:'+dtend+'\nSUMMARY:'+title+'\nEND:VEVENT\nEND:VCALENDAR';
    const a=document.createElement('a');
    a.href=URL.createObjectURL(new Blob([ics],{type:'text/calendar'}));
    a.download='event.ics';
    a.click();
    URL.revokeObjectURL(a.href);
  };
})();</code></pre>
    </div>
  </section>
</main>

<div id="toast" class="toast">已複製到剪貼簿</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script>
  document.addEventListener('click', async (e)=>{
    const btn = e.target.closest('.copybtn');
    const dl = e.target.closest('.downloadbtn');
    if(btn){
      const id = btn.dataset.copy;
      const el = document.getElementById(id);
      if(!el) return;
      const text = el.textContent;
      try{ await navigator.clipboard.writeText(text); showToast('已複製到剪貼簿'); }
      catch{
        const ta=document.createElement('textarea');
        ta.value=text; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        showToast('已複製到剪貼簿');
      }
    }
    if(dl){
      const id = dl.dataset.download;
      const filename = dl.dataset.filename || 'code.txt';
      const el = document.getElementById(id);
      if(!el) return;
      const blob = new Blob([el.textContent], {type:'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);
      showToast('已下載：' + filename);
    }
  }, {passive:true});
  const toast=document.getElementById('toast');
  function showToast(msg){toast.textContent=msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),1100);}
</script>
</body>
</html>
